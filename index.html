<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - Animated Spirals</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <audio id="background-music" src="./img/backgroundmusic.mp3" autoplay loop></audio>

    <nav class="tab-bar">
        <ul>
            <li><a href="index.html" class="tab"><div class="nav---link-bg-square"></div>WORKS</a></li>
            <li><a href="About.html" class="tab"><div class="nav---link-bg-square"></div>ABOUT</a></li>
            <li><a href="contact.html" class="tab"><div class="nav---link-bg-square"></div>CONTACT</a></li>
        </ul>
    </nav>

    <div id="animation-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    
    <script>
        let spirals = [];
        let particles = [];
        let lastScrollY = 0;
        const colors = ['#FF9079', '#FFEB98', '#A0A0A0']; // 原始螺旋顏色
        const burstColor = '#B0F8F8'; // 你指定的爆發顆粒顏色

        // 方形粒子類別
        class SquareParticle {
            constructor(x, y) {
                this.pos = createVector(x, y);
                // 爆炸式隨機速度
                this.vel = p5.Vector.random2D().mult(random(2, 6));
                this.acc = createVector(0, 0.08); // 輕微重力感
                this.size = random(4, 8); // 小方形大小
                this.angle = random(TWO_PI);
                this.angVel = random(-0.2, 0.2);
                this.life = 255; 
            }

            update() {
                this.vel.add(this.acc);
                this.pos.add(this.vel);
                this.angle += this.angVel;
                this.life -= 7; // 消失速度
            }

            display() {
                push();
                translate(this.pos.x, this.pos.y);
                rotate(this.angle);
                // 設置顏色 #B0F8F8 (RGB: 176, 248, 248)
                fill(176, 248, 248, this.life);
                noStroke();
                rectMode(CENTER);
                rect(0, 0, this.size, this.size);
                pop();
            }

            isDead() {
                return this.life <= 0;
            }
        }

        function setup() {
            let container = document.getElementById('animation-container');
            let canvas = createCanvas(container.offsetWidth, container.offsetHeight);
            canvas.parent('animation-container');
            generateStaggeredSpirals();
            lastScrollY = window.scrollY;
        }

        function generateStaggeredSpirals() {
            spirals = [];
            let cols = 4;
            let rows = 2;
            let cellW = width / cols;
            let cellH = height / rows;

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    let offsetX = (r % 2 === 1) ? cellW * 0.3 : -cellW * 0.1;
                    let x = (c * cellW) + (cellW / 2) + offsetX + random(-cellW * 0.1, cellW * 0.1);
                    let y = (r * cellH) + (cellH / 2) + random(-cellH * 0.1, cellH * 0.1);
                    
                    x = constrain(x, 80, width - 80);
                    y = constrain(y, 60, height - 60);

                    let isLarge = random() > 0.5;
                    let spiralSize = isLarge ? random(12, 15) : random(7, 9);

                    spirals.push({
                        x: x, y: y,
                        size: spiralSize,
                        rotDir: random() > 0.5 ? 1 : -1,
                        startAngle: random(TWO_PI),
                        speedMult: isLarge ? random(0.7, 0.9) : random(1.1, 1.4),
                        colorSet: [color(colors[0]), color(colors[1]), color(colors[2])],
                        noiseSeed: random(1000)
                    });
                }
            }
        }

        function draw() {
            background(248); 
            
            // 滑動偵測：爆發顆粒
            let currentScrollY = window.scrollY;
            if (abs(currentScrollY - lastScrollY) > 1) {
                for (let s of spirals) {
                    if (random() < 0.25) { // 噴發頻率
                        particles.push(new SquareParticle(s.x, s.y));
                    }
                }
            }
            lastScrollY = currentScrollY;

            let container = document.getElementById('animation-container');
            let rect = container.getBoundingClientRect();
            let progress = map(rect.top, window.innerHeight, -rect.height, -0.2, 1.0, true);
            progress = constrain(progress, 0, 1);
            let scrollAngle = progress * TWO_PI * 1.1;

            // 繪製螺旋
            for (let s of spirals) {
                push();
                translate(s.x, s.y);
                for (let i = 0; i < 3; i++) {
                    let angleOffset = i * (TWO_PI / 3) + s.startAngle;
                    strokeWeight(0.5);
                    stroke(240); 
                    drawSpiralLines(TWO_PI * 1.3, angleOffset, 0, s, true);

                    if (progress > 0.01) {
                        let targetColor = lerpColor(s.colorSet[0], s.colorSet[1], i/2);
                        targetColor.setAlpha(map(progress, 0, 1, 0, 180));
                        stroke(targetColor);
                        let colorWeight = map(progress, 0, 1, 0.8, 2.5);
                        colorWeight += map(noise(frameCount*0.05, s.noiseSeed + i), 0, 1, -0.3, 0.3);
                        strokeWeight(constrain(colorWeight, 0.5, 3.2));
                        drawSpiralLines(scrollAngle, angleOffset, progress, s, false);
                    }
                }
                pop();
            }

            // 更新並顯示方形顆粒
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                particles[i].display();
                if (particles[i].isDead()) {
                    particles.splice(i, 1);
                }
            }
        }

        function drawSpiralLines(totalAngle, offset, progress, config, isBaseLine) {
            noFill();
            beginShape();
            let roughness = isBaseLine ? 1.2 : (2.2 + progress * 2);
            for (let a = 0; a <= totalAngle; a += 0.12) {
                let r = a * config.size;
                let animRotation = progress * PI * 0.3 * config.rotDir * config.speedMult;
                let basePathX = cos((a * config.rotDir) + offset + animRotation) * r;
                let basePathY = sin((a * config.rotDir) + offset + animRotation) * r;
                let noiseX = map(noise(a * 0.4, config.noiseSeed), 0, 1, -roughness, roughness);
                let noiseY = map(noise(a * 0.4 + 100, config.noiseSeed), 0, 1, -roughness, roughness);
                curveVertex(basePathX + noiseX, basePathY + noiseY);
            }
            endShape();
        }

        function windowResized() {
            let container = document.getElementById('animation-container');
            if(container) {
                resizeCanvas(container.offsetWidth, container.offsetHeight);
                generateStaggeredSpirals();
            }
        }
    </script>

    <div class="main-content-wrapper">
        <div class="container4">
            <a href="harmonikids.html" class="card">
                <img src="./img/home_1.png" alt="Home Image 1">
                <div class="text">
                     <p class="hover-title">AI 兒童音樂探索家</p>
                     <p class="hover-link">Product / UIUX Design</p>
                </div>
            </a>
            <a href="buzzaway.html" class="card">
                 <img src="./img/home_2.jpg" alt="Home Image 2">
                 <div class="text">
                     <p class="hover-title">BuzzAway 防蚊排水守門者</p>
                     <p class="hover-link">Product / UIUX Design</p>
                 </div>
            </a>
            <a href="lamarzocco&disney.html" class="card">
                <img src="./img/home_3.jpg" alt="Home Image 3">
                <div class="text">
                     <p class="hover-title">La Marzocco & Disney 咖啡機</p>
                     <p class="hover-link">Product Design</p>
                </div>
            </a>
             <a href="26cookies+bauhaus.html" class="card">
                <img src="./img/home_4.png" alt="Home Image 4">
                <div class="text">
                     <p class="hover-title">包浩斯花卉 / Cookies26</p>
                     <p class="hover-link">Graphic Design</p>
                </div>
            </a>
             <a href="dailynecessities.html" class="card">
                <img src="./img/home_5.jpg" alt="Home Image 5">
                <div class="text">
                     <p class="hover-title">生活用品 - 榨汁器 / 土司機 / 藥盒 </p>
                     <p class="hover-link">Product Design</p>
                </div>
            </a>
        </div>
    </div>
</body>
</html>